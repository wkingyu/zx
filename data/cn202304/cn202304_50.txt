通用在网计算系统架构及协议设计 姚柯翰  等 热点专题
中兴通讯技术
2023  年 8 月    第 29 卷第  4 期   Aug . 2023    Vol . 29  No. 43）调度器根据任务分解策略将计算任务拆解为主机任
务和在网计算任务 ，拆解时需要考虑主机和在网计算的能力
和资源 ，然后告知在网计算控制器该任务具体要执行哪些在
网计算原语 。
4）当主机节点有数据要执行在网计算时 ，首先向在网
计算控制器发送请求 ，说明在网计算任务 ID、源节点 、目
的节点 、要执行的在网计算原语 ，然后由 UniqueID 对业务
分配标识 。
5）在网计算控制器根据网络拓扑 、在网计算能力 、网
络负载等情况进行综合选路 ，将选路结果反馈给主机侧 ，并
在网络设备上做在网计算资源预留 。6）源服务器发送数据包 ，接入交换
机封装 SRv6头，各网络节点根据协议包
头在网计算指示信息执行在网计算 。
3.2 基于 SRv6协议报文头扩展
国际互联网工程任务组 （IETF ）定
义了 SRv6段标识符 （SID）中的 Function
字段的通用转发行为[9]。如图 5所示，我
们新增了 INC Segment 定义在网计算行
为。其中 ，Locator 与其他 segment 保持一
致，表示路由位置信息 ；Function 字段表
示具体要做的在网计算原语 ；Arguments
指示对应 Optional TLV （类型 、长度 、值
的组合 ）的类型 ，可以由应用自行定义 ；
Optional TLV 可以用来携带在网计算原语
所需要的信息 ，例如需要处理的数据偏
移、计算需要的参数等 。
节点在执行在网计算时 ，不能影响
正常转发 ，因此需要增加复合 Segment ，使在网计算交换机
同时支持正常转发和在网计算能力 ，具体如 图6所示 。复合
Segment 用来指示后续两个连续的 Segment 都需要在本节点处
理，第1个为正常转发 Segment （Forwarding Segment ） ，第2
个为在网计算 Segment 。
3.3 交换机在网计算原语能力传播
交换机的在网计算原语可以由控制器统一管理 ，并基于
路由协议进行信息扩展 ，再传递到相应的在网计算执行节
点。例如 ，自治域内源路由使用内部网关协议 （IGP）来传图4 集中式通用在网计算框架CPU：中央处理器      GPU ：图形处理器      INC ：在网计算      RAM ：随机存取存储器
图5 SRH协议支持在网计算协议扩充INC：在网计算      IPv 6：互联网协议第 6版     SRH ：分段路由头      TLV ：类型、长度、值的组合调度器
算法模型分解任务
端主机任务 1 在网计算任务 端主机任务 2节点列表
节点 1
节点 2
……资源列表
CPU
GPU
RAM
……任务列表
任务 1
任务 2
……在网计算原语
原语 1
原语 2
……在网计算数据结构
数据结构 1
数据结构 2
……
主机 1在网计算控制器
原语
数据结构网络拓扑管理
设备管理
IPv6报文头 段路由报文头 Payload
Next Header
Last entry
Segment List [0] (128 bits IPv 6 address )
Segment List [1] (128 bits IPv 6 address )
Segment List [2] (128 bits IPv 6 address )
……
Segment List [n] (128 bits IPv 6 address )
Optional TLV (variable )Hdr Ext Len
FlagsRouting Type
TagSegments Left
Locator Function Arguments
类型 长度 值路由信息 要执行的指令
扩充 INC原语进一步定义的功能
INC原语要处理的 Opt TLV Type
➡算法模型分解任务
…… 交换机 1 交换机 2 交换机 N 主机 2
46