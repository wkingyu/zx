通用在网计算系统架构及协议设计 姚柯翰  等 热点专题
中兴通讯技术
2023  年 8 月    第 29 卷第  4 期   Aug . 2023    Vol . 29  No. 4线速数据包转发 ，这对转发芯片能力有严格要求 。在当时 ，
网络设备的转发芯片并不支持可编程能力 ，因此能够在网络
设备做的计算也比较有限 。
近年来 ，随着可编程网络硬件的发展以及软件定义网络
架构的逐渐成熟 ，在网计算技术不断发展 。斯坦福大学 N. 
MCKEOWN 教授团队在 2014 年发表的论文中首次提出了协议
无关的包处理编程语言 P4[2]，用于对网络数据平面的算法和
处理逻辑进行自定义编程 ，从而实现更加灵活丰富的功能 。
目前 ，大量的学术研究聚焦在如何发挥可编程网络的灵活性
和高性能 ，可编程网络成为在网计算发展的关键使能技术 。
1.2 在网计算主要应用场景
在网计算[3]已广泛用于各种分布式系统 。在网计算将应
用相关的功能卸载至网络节点 ，实现分布式应用处理性能的
有效提升以及网络带宽资源的合理优化 。本节中 ，针对目前
在网计算在应用加速方面的主要研究 ，我们进行了总结 ，内
容主要包括在网数据聚合 、在网数据推理 、在网缓存以及在
网共识 。
1）在网数据聚合
分布式机器学习模型训练可以基于在网数据聚合进行加
速。目 前 ，主 流 分 布 式 机 器 学 习 系 统 架 构 为 环 状 规 约
（RAR）和参数服务器 （PS） ，如图 2所示。RAR 架构对网络
带宽资源占用高 ，完成一次完整的分布式机器学习模型训练
任务需要传递约模型总参数量 2倍的通信量 ，极易引起网络
拥塞 ；而PS架构则由于集中式服务器节点的吞吐瓶颈问题 ，
面临较大的聚合延迟 ，限制了分布式机器学习模型训练的效率，扩展性较差 。
在网计算可由网络交换节点实现参数聚合功能 ，既克服
了聚合节点的吞吐瓶颈问题 ，也避免了 RAR 架构高额的带
宽资源占用 ，实现了训练性能和带宽资源的有效平衡 ，极大
地提升系统的扩展性 。
2）在网数据推理
在网数据推理可实现网络流量分类和控制 。业界相关的
研究包括在网络转发设备实现决策树 、支持向量机 （SVM） 、
朴素贝叶斯等各种分类算法[8]，以及通过神经网络实现联邦
学习 ，支撑网络设备在网络路径上就近返回处理结果 ，从而
提升集群计算能力 。
与基于分析服务器的推理方式相比 ，中间层交换机推理
提前终止了终端设备发往分析服务器的原始数据流量 ，节省
了更高层核心网络的带宽 ，同时利用网络设备的高速处理来
减少推理时间 ，加速数据实时分析和控制指令响应 。
3）在网数据缓存
高性能的分布式数据存储和索引需要依赖于高性能的
Key-Value 存储 。在社交网络等高并发应用中 ，慢速的 Key-
Value 存储可能导致较大的系统尾延迟 ，进而影响系统性能 。
通过设计层次化的缓存系统 ，在边缘网络节点部署 Key-
Value 缓存服务 ，在网络设备中完成高频内容缓存以及快速
查询和响应[4]。在网数据缓存机制是高性能存储系统以及高
性能流式处理系统加速的关键 。
4）在网数据共识
在分布式系统中 ，可以通过共识协议来实现对某个数据
值或操作序列的一致性 ，比如锁定管理系统 、组播通信 、一
致性协调 。卸载共识功能的部分或全部功能卸载到网元 ，可
以减少协调延迟 ，提升分布式系统的可用性 。文献 [5]利用
可编程交换机实现了一致性算法的网内卸载 ，实验也证明了
在网数据共识对分布式系统性能的优化 。
2 通用在网计算架构
在网计算对系统的性能优化已被广泛地论证 ，但是在网
计算在架构设计层面还面临碎片化的问题 。目前 ，在网计算
主要根据应用场景进行定制化设计 ，满足相关应用的个性化
需求 ，但是这样的设计方法扩展性较差 ，不利于在网计算的
规模化应用 。
同时 ，对应用开发者而言 ，想要基于网络设备的计算能
力进行系统设计 ，既需要了解上层系统的逻辑架构 ，还要了
解底层物理网络的属性 ，包括网络设备的编程能力以及网络
的规划能力 。这也进一步提升了在网计算系统的设计门槛 ，
阻碍了在网计算的应用 。
 图2 在网数据聚合GPU：图形处理器      PS ：参数服务器      RAR ：环状规约GPU
节点 1
GPU
节点 NGPU
节点 3GPU
节点 2
……可编程交换机
聚合参数通信效率低 带宽资源占用高PS架构
参数服务器聚合
GPU
节点 1GPU
节点 2GPU
节点 3GPU
节点 N……GPU
节点 1GPU
节点 2
GPU
节点 NGPU
节点 3……RAR 架构
循环参数聚合
44