面向新型智能计算中心的全调度以太网技术 段晓东  等 专家论坛
中兴通讯技术
2023  年 8 月    第 29 卷第  4 期   Aug . 2023    Vol . 29  No. 4络需求 ，并结合逐包交换方式
下即来即转的低时延特性 、组
包交换方式下的高带宽特性 ，
本文在 GSE 技术架构中提出一
种基于报文容器 （PKTC ）的转
发及负载分担机制 。该机制根
据最终设备或设备出端口 ，将
数据包逻辑分组 ，并组装成长
度较长的 “定长 ”容器进行转
发。属于同一个报文容器的数
据包被标记为相同的容器标识 ，
沿着相同路径进行转发 ，以保
证同属于一个报文容器的数据
包保序传输 ，如图 5所示 。
在负载均衡调度时 ，报文
容器被作为转发单位 。但由于
报文是逻辑组装 ，无需额外的
硬件开销来对数据包进行组装
和还原 。在网络中转发时添加
的报文容器标识 ，仍以数据包
的形式传输 ，且无冗余数据填
充的问题 ，带宽损耗小 。
3.2.2 基于报文容器的 DGSQ 全
局调度技术
分布式高性能应用的特征
是多对一通信的 In-cast 流量模
型。如果这种流量是短暂的 ，在
出口处可以通过一定的 Buffer 进
行吸收 ；如果时间持续过长且多
个入口的流量相加远大于出口的线速带宽 ，为了避免丢包 ，
出口设备需启用反压机制保护流量 。而反压一旦出现 ，网络
的转发性能就会大幅度下降 ，从而损害分布式应用的性能 。
DCQCN 目前是 RDMA 网络应用最广泛的拥塞控制算法 ，
也是典型的被动拥塞控制算法 。发送端根据接收到的拥塞通
知报文 （CNP）动态调整发送速率 。由于 1个比特的 ECN 信
号仅能定性表示网络产生拥塞 ，但无法定量地表示拥塞程
度，所以端侧需要探测式调整发送速率 。此外 ，收敛速度慢
会导致网络吞吐性能下降 。解决网络拥塞丢包最直接的手段
是防止过多的数据注入到网络中造成拥塞 ，保证网络中任意
设备端口缓存或链路容量不会过载 。
如图 6所示，GSP1的A1口和 GSP3的A3口同时向 GSP2的A2口发送流量 ，且流量相加大于 A2的出口带宽 。这造成
A2口出口队列拥塞 。这种情况仅通过负载均衡是无法规避
的，需要全局控制保证送到 A2的流量不超过其出口带宽 。
因此 ，引入基于全局的转发技术和基于 DGSQ 的调度技术 ，
才可实现全局流量的调度控制 。
基于 DGSQ 的全局调度技术 如图 7所示，在GSP 上建立
网络中所有设备出口的虚拟队列 ，用以实现本 GSP节点到对
应所有出端口的流量调度 。本GSP 节点的 DGSQ 调度带宽依
赖授权请求和响应机制 ，由最终的设备出口 、途经的设备统
一进行全网端到端授权 。由于中间节点的流量压力差异 ，
GSP 去往最终目的端口不再通过等价多路径路由 （ECMP ）
（路径授权权重选择路径 ，而是需要基于授予的权重在不同▲图4 组包交换示意图
▲图5 报文容器转发示意图
▲图6 网络 In-cast 流量发生场景GSF ：网络核心交换节点      GSP ：网络边缘处理节点6 5 4 3 2 1脊节点
交换机
脊节点
交换机
脊节点
交换机5 2报文头
5
报文头3 2 1报文头
叶节点
交换机6 5 4 3 2 1叶节点
交换机
GSF1 GSF2
GSP1 GSP2 GSP3
A1 B1 C1 A2 B2 C2 A3 B3 C3D1A4A5B5C5
E1D1C4B4
E1
出口产生拥塞3 2 3121
444 3 2 1
4 3 2 1叶节点
交换机叶节点
交换机4 3 2 1
4 3 2 1脊节点
交换机
脊节点
交换机
脊节点
交换机
61