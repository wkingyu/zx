生成式大模型承载网络架构与关键技术探索 唐 宏   等 热点专题
中兴通讯技术
2024  年 4 月    第 30 卷第  2 期   Apr . 2024    Vol . 30  No. 22）超高带宽 。机内通信中 GPU 间的 AllReduce 集合通
信数据量可达百 GB级别 。机间 GPU 通信涉及多种并行模
式，产生大量集合通信数据 ，机间 GPU 的高速互联对于网
络的单端口带宽 、节点间的可用链路数量及网络总带宽提出
了 很 高 的 要 求 。同 时 ，高 速 串 行 计 算 机 扩 展 总 线 标 准
（PCIe）的总线带宽限制了网卡性能的发挥 ，需适配更高带
宽的总线技术以提升机间通信效率 。
3）超低时延 。对于千亿参数模型来说 ，通信的端到端
耗时占比仅为 20%，而对于万亿参数模型 ，占比增加至
50%[1]。传统的流控算法和拥塞控制算法在面对生成式大模
型训练网络时 ，会遇到拥塞头阻 、拥塞扩散等挑战 。此外 ，
AI训练中流量的特征是 “少流 ”和“大流 ” ，使得传统的等
价多路径 （ECMP ）流量均衡机制因 ECMP 哈希极化问题造
成链路上流量不均而失效 。
4）自动化运维 。当GPU 集群规模达到一定量级后 ，保
障集群系统的稳定高效运行就成为大模型工程化实践中极其
重要的环节 。与单点 GPU 故障相比 ，网络故障会影响数十
个甚至更多 GPU 的连通性 。高性能网络的自动化部署 、一
键式故障定位和业务无感自愈 ，将决定整个集群的计算稳
定性 。
随着生成式大模型参数规模的快速增长 ，传统的数据中
心网络架构已经很难满足其训练需求 。高性能 、高可用的承
载网络底座将成为推动其发展的核心基础设施 。
2 大模型云网基础架构与关键技术
2.1 网络架构
传统的数据中心拓扑结构为 3层的树形拓扑结构 。树形
结构原理简单 ，易于部署 ，但是当面对大模型训练中要求集
群内服务器协作完成训练任务的场景时 ，该结构拓展能力显
得不足 ，服务器间通信受限 。
与传统树形网络拓扑中的逐层带宽收敛相比 ，Fat-Tree
网络具有无阻塞和无带宽收敛的特性[3]，目前被主流公有云
厂商大规模应用于 GPU 密集型集群中[4]，如图 2所示 。单台
服务器配备高性能的 400 Gbit/s NIC 网卡 ，K台服务器为一
组，通过架顶式 （ToR）交换机互接 。ToR交换机与聚合交
换机相连形成一个 Pod，实现跨机架的连接 。Pod与主干交
换机相连 ，确保中央处理器 （CPU）集群中的服务器能够实
现any-to-any 通信 。但是当网络大规模扩展时 ，受到核心交
换机端口数限制 ，Fat-Tree 的横向拓展能力变差[5]。同时 ，
为数以万计的 GPU 提供非阻塞连接的成本非常昂贵 。
生成式大模型的发展确立了以 GPU 为中心的集群主导地位 。现阶段 ，GPU 间通信采用层次化网络承载 ：
1）机内网络 ：利用 PCIe 总线 、NVLink 、NVSwitch 等技
术，实现单台服务器内等多个 GPU 高带宽短距离互联 ，为
每个 GPU 提供太比特级的无阻塞 any-to-any 带宽输入 /输出 ，
以便将短程通信流量驻留在高带宽域内 。
2）机间网络 ：利用网卡 +交换机模式 ，实现多个高带
宽域互连 。服务器间使用远程直接内存访问 （RDMA ）将数
据（中间结果 、梯度等 ）从一个 GPU 内存传输到另一个
GPU 内存中 （在不同服务器上 ） 。
在生成式大模型训练中 ，模型参数和数据集分布在集群
中的不同 GPU 上，开展并行训练 。训练各阶段的工作负载
特征 （参数大小 、数据集大小和模型架构 ）不同 ，流量模型
也差异很大 。为此 ，模型设计在优化网络拓扑和提高 GPU
效率方面发挥着至关重要的作用 。在实际网络部署中 ，需要
根据各训练阶段的工作负载模型和流量特征 ，有针对性地开
展网络拓扑设计优化和硬件设备 （如交换机 ）定制 。如
Google 使用了 3D环面和光学主干交换机 ，Meta 使用的具有
超额订阅主干链路的轨道优化叶交换机 。一些高性能计算
（HPC）结构还使用蜻蜓拓扑来优化 GPU 之间的跳数 。
目前 ，大模型集群多部署于同一个地域机房内 。随着大
模型训练的模型参数规模 、数据规模和算力规模的快速发
展，单个数据中心机房的硬件设施如电力 、液冷 、空调等硬
件基础设施能力将趋于极限 。大模型集群数据中心的超长距
图2 Fat-Tree 网络架构ToR：架顶式主干
交换机主干
交换机主干
交换机…………
……
……
……
Pod Pod机架 1 机架 2 机架 M-1 机架 M服务器  K服务器 1聚合
交换机
ToR
交换机聚合
交换机
ToR
交换机
服务器  K服务器 1
服务器  K服务器 1聚合
交换机
ToR
交换机
服务器  K服务器 1聚合
交换机
ToR
交换机
51