生成式大模型承载网络架构与关键技术探索 唐 宏   等 热点专题
中兴通讯技术
2024  年 4 月    第 30 卷第  2 期   Apr . 2024    Vol . 30  No. 22.4 负载均衡技术
RDMA 的大规模组网通常采用基于 Fat-Tree 的Clos 架
构。基于 Fat-Tree 的Clos 架构的基本理念是使用大量的商用
交换机 ，在服务器之间构造出多个等价路径 ，交换机对流进
行ECMP 实现负载均衡 ，进而形成大规模的无阻塞网络 。
与传统数据中心的流量分布不同 ，大模型训练网络中多
为大象流 ，数量相对较少 。这使得传统的 ECMP 存在哈希极
化现象 ，即多个流可能分配到同个链路上 ，负载不均造成流
冲突 。同时 ，由于 ECMP 还是一个无状态的局部决策 ，不关
心不同流的大小差异 ，在流数目不多且大小流长尾严重时 ，
容易造成多条路径中某些路径拥塞而另一些路径空闲 ，从而
造成带宽浪费和影响传输效率 。因此 ，负载均衡是大规模
AI集群网络面临的又一挑战 。针对 ECMP 存在问题 ，有以下
两种负载均衡优化方案 ：
第1种方案是改变流的属性 ，把流分散到多个等价路径
上。在交换机 ECMP 不变的情况下 ，改变流的标签 ，或增加
流的熵 （将流分割成更小的流或基于报文头的其他位置字段
做哈希 ） ，让流变得更多从而能通过哈希散开 。代表性方法
有PLB[15]，在主机端利用拥塞探测感知拥塞的流 ，对拥塞流
的流标签进行更改 ，引导交换机对流进行重新等价多路径
ECMP/ 加权多路径 （WCMP ）哈希 ，从而为拥塞流选择新
路径 。
第2种方案是基于网络状态的流量调优 。通过实时收集
网络拓扑和流量等信息 ，由集中软件定义网络 （SDN）控制
器为每条流计算出最优路径 ，或由交换机进行自适应路由选
择，包括集中式流量工程[16]、自适应路由技术[17]和网络级负
载均衡技术[18]等。
1）集中式流量工程[16]：SDN 控制器实时收集网络拓扑
和任务放置信息 ，基于约束最短路径算法为各个流计算最优
路径 。
2）网络级负载均衡技术[17]：根据大模型训练的流量特
征，综合网络拓扑等整网信息 ，计算出最优的流量转发
路径 。
3）自适应路由技术[18]：交换机根据出口队列负载评估
拥塞情况 ，为每个数据包选择最不拥塞的端口进行数据传
输，以实现负载均衡 。由于同一流的不同数据包可能由不同
网络路径传输 ，到达目的节点时可能出现乱序 ，因此需要网
卡侧在 RoCE 传输层完成对无序数据的转换 ，再将有序数据
传递给应用程序 。
此外 ，目前一些研究[19-20]也指出 ：原生 RoCE 协议中规
定数据包顺序到达的设计弊端是制约负载均衡的关键因素 。
未来应从根本上改进传输协议 ，采用数据包喷洒等技术 ，使得数据包可以通过多路径顺序传输 ，然后再利用可编程交换
机或智能网卡重新对数据包排序 ，以充分利用网络的多个可
用路径实现负载均衡 。
2.5 自动化运维技术
现阶段针对大模型训练的 AI集群网络已达万卡规模[21]，
未来要扩展到十万和百万卡量级 ，传统依靠人工的网络运维
已经无法满足需求 。同时 ，由于故障无法避免 ，需要有自动
化机制来实现部署和测试 ，并持续监控网络状态 ，减少故障
和排除故障 ，实现自动化运维 。自动化网络运维技术研究主
要集中以下几个方向 ：
1）端网一体自动化部署和测试 ：集成多种自动化工具 ，
研发自动选择配置模板 ，实现全网流控 、拥塞控制 、负载均
衡等关键指标参数的自动化配置和测试验证 ，缩短大模型训
练系统的整体部署时间 。
2）信息采集压缩和关键信息提取 ：传统运维采用简单
网络管理协议 （SNMP ） “拉模式 ”流量采样方式 ，采样精度
在分钟级别 ，颗粒度较粗 。为实现无损网络 ，RDMA 网络需
要全栈巡检和毫秒级的实时监控 。除流量信息外 ，还要采集
拓扑 、网卡 、交换机端口 、流控参数等更细颗粒度的信息 。
Telemetry 采用 “推模式 ”流量采集方式 ，虽然可以实现精
细化采集 ，但在网络中全面开启开销巨大 ，严重影响网络性
能。为此 ，需要根据网络架构和训练模型 ，定制化采样精度
和信息采集策略 ，并动态按需调整 。为实现高效分析 ，还需
对低频变化信息进行高压缩 ，提取关键信息 ，结合带内网络
遥测探测流交叉覆盖 ，实现轻量级近似全链路监控 。
3）快速故障定位及自愈 ：基于多维度的网络指标信息
进行故障根因分析 ，快速定位故障 。同时配置故障自愈策
略，故障时通过路径切换或节点替换 ，尽可能地缩短故障恢
复时间 。例如 ，利用硬件实现故障感知 ，无须通过控制面 ，
仅通过数据面的故障通告和故障切换策略 ；无须等待全网收
敛，仅基于端侧智能网卡修改数据包头特定字段的重路由策
略等 。
3 未来技术展望
大模型的持续发展对算力需求增长迅速 ，因此高性能高
可用的云网基础设施非常必要 。打造满足下一代大模型训练
需求的低时延 、大带宽和高吞吐网络 ，需要构建新型网络架
构，以匹配大模型训练的 “大流 ” “少流 ”的流量特征 ；需
要研究确定性网络等新技术 ，满足广域网远距离大模型中心
互联需求 ；需要设计针对大模型通信流量的新型网络协议 、
拥塞控制和负载均衡机制 ，实现网络无拥塞和丢包 ，有效利
54