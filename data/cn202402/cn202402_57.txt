生成式大模型承载网络架构与关键技术探索 唐 宏   等 热点专题
中兴通讯技术
2024  年 4 月    第 30 卷第  2 期   Apr . 2024    Vol . 30  No. 2得iWARP 在面对有损网络场景时相比于 RoCEv 2和IB具有更
好的可靠性 。但是大量的 TCP 连接会耗费很多的内存资源 ，
另外 TCP 复杂的流控等机制会导致性能问题 ，限制了其应用
范围 ，现阶段并未大规模使用 。
综上所述 ，IB在高性能计算领域表现出色 ，可提供卓
越的性能 、低延迟和可扩展性 ，目前在高性能计算领域占据
较大优势 。相比之下 ，RoCE 则更容易集成到现有以太网基
础设施中 ，并具有较低的成本 ，是现阶段大模型训练网络的
主流方案 。
生成式大模型的迅速发展对底层承载网络的性能要求越
来越高 。业界仍持续开展传输协议的创新 。一些云计算和互
联网巨头推出新的自研协议 。例如 ，亚马逊提出的可扩展的
可靠数据报 （SRD）[7]。SRD 设计了多路径负载均衡机制 ，
利用尽可能多的不拥塞的网络路径喷洒数据包 ，在上层消息
传递层实现对可靠但乱序的交付数据包进行顺序恢复 。通过
多路径发送和数据包重排序 ，提升了网络吞吐能力 ，降低了
传输延迟 。
2023 年，由众多云计算和网络科技巨头组成超以太联
盟，针对 IB的封闭生态和原有 RoCE 的不足 ，提出了下一代
人 工 智 能 （AI）和HPC 网 络 的 协 议 ：超 级 以 太 网 传 输
（UET）[8]。基于 IP和以太网进行设计 ，在基于多路径和数
据包喷洒负载均衡 、Incast 管理机制 、高效的速率控制算法 、
允许乱序数据包传递的应用程序编程接口 （API）等方向进
行了创新 ，以减少针对特定网络和负载对拥塞算法的复杂参
数调优 ，支持百万节点的大规模网络扩展 。
在2023 开源计算 （OCP）全球峰会上 ，谷歌还提出基
于新硬件的传输协议 Falcon[9]，集成了谷歌多年在网络传输
方面的一系列创新技术 ，包括拥塞控制 Swift 和保护性负载
均衡 （PLB）等，推动以太网现代化 ，以满足下一代大规模
AI集群网络的高可靠 、高性能 、低时延需求 。
2.3 拥塞控制技术
RDMA 设计目标是高性能和低延迟 ，它对于底层网络的
稳定性和可靠性有极高的要求 。网络的可用性决定了整个集
群的计算稳定性 。RDMA 在无损网络状态下可以满速率传
输。但一旦发生丢包 ，将启动 “go-back- N”重传机制 ，放
弃已到达的多个包 ，重新传输 N个包 ，性能急剧下降 。然
而，现网拓扑复杂度高 ，流量流向不可预测 。因此流控 、拥
塞控制 、负载均衡机制对于 RDMA 现网落地商用非常重要 。
传统的 RDMA 网络采用基于优先级的流量控制 （PFC）
流控实现无损以太网[10]。PFC 允许交换机在传输数据帧时 ，
对不同数据流设置不同的优先级 。一旦交换机的队列超过设定门限 ，通过逐跳的流量反压 ，限制发送方的流量速率保障
网络无丢包 。PFC 流控可以在理论上保证不丢包 ，但PFC 以
端口级别运行 ，是一种粗粒度控制机制 。规模部署时存在头
部阻塞 、受害者流 、PFC风暴和 PFC死锁等问题 。
流级别的拥塞控制算法可以缓解 PFC 缺陷 。网络路径上
的交换机对流量拥塞情况进行标记 。携带拥塞标记信号的报
文到达接收者后 ，再被传回发送者由其根据网络拥塞情况进
行调速 。在充分利用带宽的前提下 ，降低网络拥塞程度可以
避免频繁触发 PFC。现阶段存在多种拥塞控制算法 ，已大规
模部署的有 ：数据中心量化拥塞通知 （DCQCN ）[11]、基于
延迟的拥塞控制 （TIMELY[12]、Swift [13]）和高精度拥塞控制
（HPCC ）[14]。它们主要区别在于采用的拥塞反馈信号和发送
端速率调整方式不同 。
DCQCN 采用 IP报文头中的显示拥塞指示算法 （ECN）
作为拥塞标记 。发送端根据 ECN 标记情况来推测网络拥塞
情况 ，对源速率进行调整 。但ECN 标记只携带了有限的信
息，拥塞控制调节的颗粒度较粗 。目前 RDMA 网卡商业上直
接可用 ，应用最为广泛 。
TIMELY 将数据包的往返时延 （RTT）作为反馈信号来
调整发送端的速率 。发送者在主机网卡上对端到端 RTT 进行
测量 ，基于其变化进行梯度计算 ，再根据梯度实现基于速率
的调速方法 。Swift 在TIMELY 基础上进行改进 ，将时延进一
步区分为网络拥塞和主机拥塞造成的时延 ，并维持两个拥塞
窗口进行调速 。目前主要是在 Google 数据中心使用 ，依赖于
Google 的自研网卡 。
HPCC 利用带内网络遥测收集更详细的链路和端口负载
信息 ，包括时间戳 、队列长度 、已传输字节数和链路带宽容
量等 ，并以此调整发送端的发送窗口 ，实现高精度拥塞
控制 。
面向超大规模的大模型集群网络 ，上述拥塞控制和流控
技术的性能仍然需要提升 。现阶段的研发主要集中在两个方
向：一方面研究更合适的效能函数来准确评价网络环境的拥
塞状态 ，更准确地探测可用带宽和时延等参数 ，使发送端获
得更准确的数据 ，从而提高决策的精确性 ；另一方面 ，可以
进一步细化拥塞窗口的调节方案和不同类型流量调度机制 ，
在兼顾网络的稳定和带宽利用率的同时 ，保证数据传输
质量 。
此外 ，在研的新一代的 RDMA 网卡将采用更为高效的丢
包恢复机制和更好的端到端流控来约束 in-flight 数据包 ，不
依赖于 PFC 的RoCEv 2网络成为了未来的发展方向 。这将有
助于把 RDMA 推广到规模更大 、跳数更多的网络中 。
53